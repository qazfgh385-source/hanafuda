<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>花札どんどん 得点管理</title>
<style>
body { font-family: sans-serif; text-align:center; background:#f2f2f2; }
button { padding:10px 20px; margin:5px; font-size:16px; }
input, select { padding:8px; margin:5px; width:80%; font-size:16px; }
.card { background:white; padding:15px; margin:10px; border-radius:10px; }
</style>
</head>
<body>

<h2>花札どんどん 得点管理</h2>
<div id="app"></div>

<script>
let players = [];
let totals = {};
let pot = 0;
let bet = 0;

function setupPlayers(){
    let n = parseInt(document.getElementById("num").value);
    let html = "";
    for(let i=0;i<n;i++){
        html += `<input id="name${i}" placeholder="プレイヤー名"><br>`;
    }
    html += `<button onclick="startGame(${n})">開始</button>`;
    document.getElementById("app").innerHTML = html;
}

function startGame(n){
    players = [];
    totals = {};
    for(let i=0;i<n;i++){
        let name = document.getElementById(`name${i}`).value;
        players.push(name);
        totals[name] = 0;
    }
    showBet();
}

function showBet(){
    document.getElementById("app").innerHTML = `
    <div class="card">
    ベット額<br>
    <input id="bet" type="number"><br>
    <button onclick="afterBet()">確定</button>
    </div>`;
}

function afterBet(){
    bet = parseInt(document.getElementById("bet").value);
    pot = 0;
    players.forEach(p=>{
        totals[p] -= bet;
        pot += bet;
    });
    showWinner();
}

function showWinner(){
    let options = players.map(p=>`<option>${p}</option>`).join("");
    document.getElementById("app").innerHTML = `
    <div class="card">
    勝者<br>
    <select id="winner">${options}</select><br>
    ぞろ目勝ち？ <input type="checkbox" id="zoro"><br>
    <input id="month" type="number" placeholder="ぞろ目の月"><br>
    <button onclick="finishRound()">結果</button>
    </div>`;
}

function finishRound(){
    let winner = document.getElementById("winner").value;
    let zoro = document.getElementById("zoro").checked;
    let winAmount = pot;

    if(zoro){
        let month = parseInt(document.getElementById("month").value);
        let bonusEach = month * 100;
        players.forEach(p=>{
            if(p!==winner){
                totals[p] -= bonusEach;
                winAmount += bonusEach;
            }
        });
    }

    totals[winner] += winAmount;
    showStatus();
}

function showStatus(){
    let html = "<div class='card'><h3>現在の収支</h3>";
    players.forEach(p=>{
        let sign = totals[p]>=0?"+":"";
        html += `${p} : ${sign}${totals[p]}円<br>`;
    });
    html += `<button onclick="showBet()">次のラウンド</button></div>`;
    document.getElementById("app").innerHTML = html;
}

document.getElementById("app").innerHTML = `
人数入力<br>
<input id="num" type="number"><br>
<button onclick="setupPlayers()">決定</button>
`;
</script>

</body>
</html>
